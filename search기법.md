# Vue 코드 파편화 및 검색 개선 방안

## 파편화 구조
Vue 컴포넌트를 4가지 단위로 파편화하는 접근법:
- **component**: 컴포넌트 전체
- **template**: 템플릿 섹션
- **script**: 스크립트 섹션
- **style**: 스타일 섹션

이 구조는 Vue SFC(Single File Component)의 실제 구성을 자연스럽게 반영하여 효과적입니다.

## 현재 검색 메커니즘
- **Bi-Encoder 기반 벡터 검색**: 'dragonkue/BGE-m3-ko' 모델 사용
- **키워드 검색**: 단어 매칭 및 부분 문자열 검색 기반
- **앙상블 검색 기법**: 벡터 검색과 키워드 검색을 결합하여 검색 품질 향상
- **메타데이터 보강**: 파편 간의 관계 및 컨텍스트 정보 유지
- **Cross-Encoder 재랭킹**: 'dragonkue/bge-reranker-v2-m3-ko' 기반 파인튜닝 모델로 정확도 향상

## 검색 정확도 향상 전략

### 3단계 검색 파이프라인

#### 1. Bi-Encoder 벡터 검색
- 빠른 1차 후보군 선별
- 'dragonkue/BGE-m3-ko' 모델 활용
- 광범위한 관련 파편 확보
- 임베딩 벡터 간 코사인 유사도 계산

#### 2. 키워드 검색
- 정확한 단어 매칭에 가중치 부여
- 부분 문자열 매칭 지원
- 파일 타입 및 컴포넌트 타입별 가중치 적용
- 단순하지만 정확한 키워드 기반 필터링

#### 3. 의미 기반 검색
- 동의어, 연관어, 문맥적 유사성 포착
- 'jhgan/ko-sroberta-multitask' 모델 사용
- 벡터 검색과는 다른 의미 이해 방식으로 상호 보완
- 캐싱 메커니즘으로 성능 최적화

### 앙상블 검색 기법
- 세 가지 검색 방식의 결과를 결합하여 정확도 향상
- 각 검색 방식에 가중치 부여 (벡터 0.4, 키워드 0.2, 의미 0.4)
- 점수 정규화를 통한 공정한 결합
- 다양한 관점의 검색 결과를 통합하여 검색 품질 향상

### Cross-Encoder 재랭킹
- 앙상블 검색 결과에 대한 정교한 재평가
- 파인튜닝된 'dragonkue/bge-reranker-v2-m3-ko' 모델 활용
- 질문-파편 쌍의 직접적인 관련성 평가
- 최종 정확도 극대화

```python
def rerank_with_cross_encoder(query, candidates, cross_encoder_model, top_k=3):
    """Cross-Encoder를 사용하여 후보군 재랭킹"""
    pairs = [[query, candidate['content_preview']] for candidate in candidates]
    scores = cross_encoder_model.predict(pairs)
    
    # 스코어와 후보를 결합하고 정렬
    scored_candidates = list(zip(scores, candidates))
    reranked = sorted(scored_candidates, key=lambda x: x[0], reverse=True)
    
    return [item[1] for item in reranked[:top_k]]
```

## 장단점 분석

### 장점
- **정확도 향상**: 사용자 질문과 코드 파편 간의 의미적 일치도 상승
- **다양한 관점 포착**: 서로 다른 모델이 상호 보완적 결과 제공
- **구현 용이성**: 기존 아키텍처에 모듈로 추가 가능
- **실시간 성능 유지**: 1차 검색으로 후보군을 제한하여 계산 비용 관리

### 단점
- **추가 계산 비용**: 의미 기반 검색과 Cross-Encoder는 각각 추가 계산 필요
- **시스템 복잡성 증가**: 여러 모델 관리 및 다단계 파이프라인 구현
- **메모리 사용량 증가**: 추가 모델 로드로 인한 리소스 사용량 증가
- **앙상블 가중치 조정**: 최적의 가중치 설정을 위한 추가 실험 필요

## 장기적 개선 방향

### 캐싱 전략
- 의미 기반 검색용 파편 임베딩 사전 계산 및 저장
- 자주 사용되는 쿼리에 대한 결과 캐싱
- 증분 업데이트를 통한 캐시 효율성 향상

### 파인튜닝 전략
- 사용자 질문-파편 매칭 데이터 수집
- 의미 기반 검색 모델의 Vue 코드 도메인 특화 파인튜닝
- 실제 사용 패턴 기반 모델 개선

### 구현 로드맵
1. **즉시**: 의미 기반 검색 통합 및 3단계 앙상블 구현
2. **중기**: 사용 데이터 수집 및 분석, 캐싱 메커니즘 최적화
3. **장기**: 도메인 특화 모델 파인튜닝 및 성능 평가

## 결론

Vue 코드 파편화의 현재 구조(component, script, style, template)는 매우 효과적이며, 기존 검색 메커니즘에 의미 기반 검색을 추가한 3단계 앙상블 검색 기법은 검색 정확도를 크게 향상시킬 것으로 예상됩니다. Cross-Encoder 재랭킹과의 조합을 통해 시스템의 핵심 목표인 "정확한 소스 파편 탐지"를 극대화할 수 있습니다.